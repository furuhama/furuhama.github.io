---
layout: post
title: 同一デバイス上の複数ブラウザ間での cookie 同期
date: 2021-01-28 01:38:04 +0900
tag: [minipost]
---

僕は普段 Firefox で活動しているんですけど社でセキュリティ上の理由から Chrome 使えって言われてモチベーションが 100 くらい下がっている

社の PC の Chrome からしか入れないサービスがいくつか出始めていて結構つらい

そこで例えばあるデバイス(社の PC)上の複数のブラウザ(Chrome, Firefox)で cookie を同期できたらもうちょっと幸せになれるかもしれないなと思ったのが発端

社として Chrome だけに絞っている利用ブラウザを Firefox にも無理やり広げることになるので Attack Surface も拡大するしそれってそもそもの施策の背景と反しているのではって思わないでもないけど、実際に運用するかはともかく試みとして面白そうだなと思ったので試してみる

Firefox も Chrome も sqlite の形式でローカルのデバイスに cookie を保存してる

例えば Chrome -> Firefox への単方向同期を考えると

- Chrome の cookie を定期的に読み出し変化を検知するデーモンを置く
    - 読み出しはそのままできるのか(暗号化されていないか)
    - 複数プロセスが cookie 用の sqlite ファイルを読もうとしたときに lock かかる問題は平気か
        - 参照のみだし微妙な断面が見えちゃうことに目をつぶるので多少強引にでもできないかな
- 変更があった場合に変更後の内容を読み出して Firefox の cookie に書き込む
    - 参照でおとずれた lock 問題、今度は書き込みまであって悩ましい
